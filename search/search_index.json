{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Azure Professional Services SOP Portal","text":"<p>Your single source of truth for Azure deployment procedures</p> <p>Welcome to the Azure Professional Services Standard Operating Procedures (SOP) Portal. This portal provides production-grade, repeatable procedures for deploying and managing Azure infrastructure.</p>"},{"location":"#quick-search","title":"\ud83d\udd0d Quick Search","text":"<p>Use the search bar at the top to quickly find SOPs by keyword, technology, or use case.</p>"},{"location":"#active-sops","title":"\ud83d\udccb Active SOPs","text":""},{"location":"#networking","title":"Networking","text":"<p>{: .grid-list }</p> <ul> <li>:material-network: Virtual Networking \u2013 Hub &amp; Spoke</li> <li>Deploy production-grade Hub-Spoke topology with Azure Firewall</li> <li>CAF/WAF-aligned, policy-enforced</li> <li>Last Updated: Nov 2025</li> </ul>"},{"location":"#avd-azure-virtual-desktop","title":"AVD (Azure Virtual Desktop)","text":"<p>{: .grid-list }</p> <ul> <li>:material-monitor: AVD Host Pool + FSLogix {: .new }</li> <li>Complete AVD deployment with FSLogix profile containers</li> <li>High availability and performance optimization</li> <li>Last Updated: Nov 2025</li> </ul>"},{"location":"#recently-added","title":"\ud83c\udd95 Recently Added","text":"<p>Latest Updates</p> <ul> <li>Nov 2025: Added AVD Host Pool + FSLogix SOP</li> <li>Nov 2025: Initial release with Hub-Spoke Networking SOP</li> </ul>"},{"location":"#sop-status","title":"\ud83d\udcca SOP Status","text":"Category Count Status Networking 1 \u2705 Active AVD 1 \u2705 Active Security 0 \ud83d\udea7 Coming Soon Landing Zones 0 \ud83d\udea7 Coming Soon Governance 0 \ud83d\udea7 Coming Soon Cost Optimization 0 \ud83d\udea7 Coming Soon"},{"location":"#design-principles","title":"\ud83c\udfaf Design Principles","text":"<p>Every SOP in this portal follows these principles:</p> <ul> <li>\u2705 Production-Grade: Tested and validated in real customer environments</li> <li>\u2705 Repeatable: Step-by-step procedures with clear success criteria</li> <li>\u2705 Secure-by-Default: Security best practices built-in</li> <li>\u2705 Policy-Enforced: Aligned with Azure Policy and CAF/WAF</li> <li>\u2705 Well-Documented: Includes naming conventions, checklists, and rollback procedures</li> </ul>"},{"location":"#sop-template-structure","title":"\ud83d\udcda SOP Template Structure","text":"<p>All SOPs include:</p> <ol> <li>Header: Version, Owner, Review cycle</li> <li>Objective &amp; Scope: Clear purpose and applicability</li> <li>Prerequisites: Required permissions, resources, and setup</li> <li>Step-by-Step Deployment: Detailed table with actions, tools, and success criteria</li> <li>Naming Conventions: Mandatory naming patterns</li> <li>Post-Deployment Checklist: Copy-paste ready validation checklist</li> <li>Approved Variations: Scenarios requiring architect approval</li> <li>Rollback Steps: Safe rollback procedures</li> <li>References: Links to official documentation</li> </ol>"},{"location":"#contributing","title":"\ud83e\udd1d Contributing","text":"<p>To suggest improvements or report issues:</p> <ol> <li>Click the Edit link on any SOP page</li> <li>Make your changes</li> <li>Submit a pull request</li> </ol> <p>All changes are reviewed by the respective CoE (Center of Excellence) owners.</p>"},{"location":"#support","title":"\ud83d\udcde Support","text":"<p>For questions or clarifications about any SOP:</p> <ul> <li>Open an issue in the GitHub repository</li> <li>Contact the SOP owner listed in each document</li> <li>Reach out to the Azure Professional Services team</li> </ul> <p>Portal Information</p> <ul> <li>Repository: chetanp201/azure-sops</li> <li>Live Site: chetanp201.github.io/azure-sops</li> <li>Last Updated: Nov 2025</li> </ul>"},{"location":"avd/sop-avd-host-pool-fslogix/","title":"SOP \u2013 Azure Virtual Desktop (AVD) Host Pool + FSLogix Profile Container","text":"<p>Version: 1.0 | Valid as of: Nov 2025 Owner: Azure AVD CoE | Review cycle: Every 6 months</p> <p>Quick Links</p> <p>:material-pencil: Edit this SOP |  :material-clock-outline: Last Updated</p>"},{"location":"avd/sop-avd-host-pool-fslogix/#objective","title":"Objective","text":"<p>Deploy a production-grade Azure Virtual Desktop (AVD) host pool with FSLogix profile containers, ensuring high availability, performance, and security for enterprise virtual desktop infrastructure.</p>"},{"location":"avd/sop-avd-host-pool-fslogix/#scope","title":"Scope","text":"<p>Mandatory for ALL new AVD deployments. Applies to pooled and personal host pools. Includes FSLogix profile container setup with Azure Files Premium.</p>"},{"location":"avd/sop-avd-host-pool-fslogix/#prerequisites","title":"Prerequisites","text":"<ul> <li>Azure subscription with appropriate permissions (Contributor + User Access Administrator)</li> <li>Azure AD (Entra ID) tenant with AVD licensing (Windows 10/11 Enterprise E3/E5 or Microsoft 365)</li> <li>Network connectivity (Hub-Spoke topology recommended per Networking SOP)</li> <li>Storage account with Premium File Shares enabled</li> <li>Domain controller accessible (on-premises or Azure AD DS)</li> <li>AVD service principal or user with \"Desktop Virtualization Contributor\" role</li> </ul>"},{"location":"avd/sop-avd-host-pool-fslogix/#step-by-step-deployment","title":"Step-by-Step Deployment","text":"Step Action Tool Key Details / Success Criteria 1 Create Resource Group Portal/CLI/PowerShell Naming: <code>rg-&lt;env&gt;-avd-&lt;region&gt;-001</code> 2 Deploy Azure Files Premium Account Portal or Bicep/Terraform Performance: PremiumRedundancy: ZRS (recommended) or LRSEnable large file shares 3 Create File Share for FSLogix Profiles Azure Portal Share name: <code>fslogix-profiles</code>Quota: Based on user count (e.g., 5TB for 500 users) 4 Configure Azure Files Active Directory Authentication Azure AD DS or On-Prem AD Domain join storage accountAssign share permissions (Storage File Data SMB Share Elevated Contributor) 5 Create AVD Workspace Portal/CLI/PowerShell Naming: <code>wkspc-&lt;env&gt;-avd-&lt;region&gt;-001</code>Location: Same region as host pool 6 Create AVD Host Pool Portal/CLI/PowerShell Pool type: Pooled or PersonalLoad balancing: Breadth-first or Depth-firstMax session limit: 10 (pooled) or 1 (personal) 7 Register Session Host VMs ARM Template/Bicep/Terraform Windows 10/11 Enterprise multi-session or Windows Server 2022Domain join requiredInstall AVD agent + bootloader 8 Configure FSLogix on Session Hosts Group Policy or Registry Enable FSLogix Profile ContainerSet VHDLocations = <code>\\\\&lt;storage-account&gt;.file.core.windows.net\\fslogix-profiles</code>Set VHDNamePattern = <code>%username%</code> 9 Configure FSLogix Cloud Cache (Optional) Registry/Group Policy Enable for HA scenariosPrimary: Azure FilesSecondary: Azure Files (different region) or Azure Blob 10 Assign Users/Groups to Application Group Portal/PowerShell Create Desktop Application GroupAssign Entra ID users or groupsValidate user can access AVD feed 11 Configure Network Security NSG/Azure Firewall Allow RDP (3389) from authorized IPsAllow SMB (445) to Azure FilesBlock internet access (use Azure Firewall) 12 Enable Monitoring &amp; Diagnostics Log Analytics Workspace Enable diagnostic settings on host poolConfigure alerts for host health, session count, errors 13 Configure Scaling Plan (Pooled) Portal/PowerShell Peak hours: Start VMs 30 min beforeOff-peak: Shutdown after 10 min idleMin/Max hosts based on capacity 14 Validate User Profile Persistence Test login Log in \u2192 Create files on desktop \u2192 Log out \u2192 Log in \u2192 Verify files persist 15 Run Post-Deployment Validation PowerShell/Portal All session hosts \"Available\"Users can connectFSLogix profiles created in Azure FilesNo errors in Event Viewer"},{"location":"avd/sop-avd-host-pool-fslogix/#mandatory-naming-convention","title":"Mandatory Naming Convention","text":"<pre><code>rg-&lt;env&gt;-avd-&lt;region&gt;-001\nwkspc-&lt;env&gt;-avd-&lt;region&gt;-001\nhp-&lt;env&gt;-avd-&lt;pool-type&gt;-&lt;region&gt;-001\nag-&lt;env&gt;-avd-desktop-&lt;region&gt;-001\nsa&lt;env&gt;avd&lt;region&gt;001 (storage account, no hyphens)\nfslogix-profiles (file share name)\n</code></pre>"},{"location":"avd/sop-avd-host-pool-fslogix/#post-deployment-checklist-copy-into-ticket","title":"Post-Deployment Checklist (copy into ticket)","text":"<ul> <li>[ ] Resource Group created with correct naming</li> <li>[ ] Azure Files Premium account deployed (ZRS recommended)</li> <li>[ ] File share created with appropriate quota</li> <li>[ ] Azure Files AD authentication configured</li> <li>[ ] AVD Workspace created</li> <li>[ ] AVD Host Pool created (pooled or personal)</li> <li>[ ] Session Host VMs deployed and registered (minimum 2 for HA)</li> <li>[ ] FSLogix installed and configured on all session hosts</li> <li>[ ] FSLogix registry keys set (VHDLocations, VHDNamePattern)</li> <li>[ ] Users/groups assigned to Application Group</li> <li>[ ] Network security rules configured (NSG/Azure Firewall)</li> <li>[ ] Log Analytics workspace connected</li> <li>[ ] Scaling plan configured (if pooled)</li> <li>[ ] User profile persistence validated</li> <li>[ ] Monitoring alerts configured</li> <li>[ ] Documentation updated</li> <li>[ ] Customer sign-off obtained</li> </ul>"},{"location":"avd/sop-avd-host-pool-fslogix/#approved-variations-need-architect-approval","title":"Approved Variations (need architect approval)","text":"Scenario Allowed? Alternative Azure NetApp Files for profiles Yes Higher performance, higher cost. Use for &gt;1000 users FSLogix without Cloud Cache Yes Single region only. Not recommended for HA Personal host pools Yes 1:1 user-to-VM mapping. Higher cost, better isolation Azure AD Domain Services (AAD DS) Yes If no on-premises AD. Limited to 5,000 objects Azure Files Standard (not Premium) No Insufficient IOPS for profile containers Third-party profile solutions (Citrix, etc.) Yes Requires architect approval and migration plan"},{"location":"avd/sop-avd-host-pool-fslogix/#fslogix-configuration-details","title":"FSLogix Configuration Details","text":""},{"location":"avd/sop-avd-host-pool-fslogix/#registry-settings-group-policy-recommended","title":"Registry Settings (Group Policy Recommended)","text":"<pre><code>HKLM\\SOFTWARE\\FSLogix\\Profiles\n  Enabled = 1 (DWORD)\n  VHDLocations = \\\\&lt;storage-account&gt;.file.core.windows.net\\fslogix-profiles\n  VHDNamePattern = %username%\n  DeleteLocalProfileWhenVHDShouldApply = 1\n  FlipFlopProfileDirectoryName = 1\n  PreventLoginWithFailure = 1\n  ProfileType = 0 (0=Profile, 1=ODFC, 2=Both)\n</code></pre>"},{"location":"avd/sop-avd-host-pool-fslogix/#cloud-cache-configuration-ha-scenarios","title":"Cloud Cache Configuration (HA Scenarios)","text":"<pre><code>HKLM\\SOFTWARE\\FSLogix\\Profiles\n  CCEnalbed = 1\n  CCDLocations = type=Azure,connectionString=\"DefaultEndpointsProtocol=https;AccountName=...;EndpointSuffix=core.windows.net;\"\n</code></pre>"},{"location":"avd/sop-avd-host-pool-fslogix/#performance-optimization","title":"Performance Optimization","text":"<ul> <li>Azure Files Premium: Minimum 100 GiB (provides baseline IOPS). Scale up for more IOPS</li> <li>VHD Size: Start with 30GB per user, monitor and adjust</li> <li>Antivirus Exclusions: Exclude FSLogix VHD files and folders on session hosts</li> <li>Network: Ensure low latency between session hosts and Azure Files (&lt;5ms recommended)</li> </ul>"},{"location":"avd/sop-avd-host-pool-fslogix/#rollback-steps","title":"Rollback Steps","text":"<ol> <li>Remove user assignments from Application Group</li> <li>Stop all session host VMs</li> <li>Backup FSLogix profiles from Azure Files (if needed)</li> <li>Delete Application Group</li> <li>Delete Host Pool</li> <li>Delete Workspace</li> <li>(Optional) Delete Azure Files share and storage account</li> <li>Delete Resource Group</li> </ol>"},{"location":"avd/sop-avd-host-pool-fslogix/#troubleshooting","title":"Troubleshooting","text":""},{"location":"avd/sop-avd-host-pool-fslogix/#common-issues","title":"Common Issues","text":"<ul> <li>Users cannot connect: Check Application Group assignments, network connectivity, host pool status</li> <li>Profiles not persisting: Verify FSLogix registry settings, Azure Files permissions, network connectivity</li> <li>Slow logon: Check Azure Files IOPS, VHD size, network latency</li> <li>Session hosts unavailable: Check VM status, domain join, AVD agent health</li> </ul>"},{"location":"avd/sop-avd-host-pool-fslogix/#diagnostic-commands","title":"Diagnostic Commands","text":"<pre><code># Check FSLogix status\nGet-ItemProperty -Path \"HKLM:\\SOFTWARE\\FSLogix\\Profiles\"\n\n# Check Azure Files connectivity\nTest-NetConnection -ComputerName &lt;storage-account&gt;.file.core.windows.net -Port 445\n\n# Check AVD host pool status\nGet-AzWvdHostPool -ResourceGroupName &lt;rg-name&gt; -Name &lt;host-pool-name&gt;\n</code></pre>"},{"location":"avd/sop-avd-host-pool-fslogix/#references","title":"References","text":"<ul> <li>Azure Virtual Desktop Documentation</li> <li>FSLogix Documentation</li> <li>Azure Files Performance</li> <li>AVD Architecture Best Practices</li> </ul>"},{"location":"networking/sop-virtual-networking-hub-spoke/","title":"SOP \u2013 Azure Virtual Networking (Hub-Spoke Topology)","text":"<p>Version: 1.0 | Valid as of: Nov 2025 Owner: Azure Networking CoE | Review cycle: Every 6 months</p> <p>Quick Links</p> <p>:material-pencil: Edit this SOP |  :material-clock-outline: Last Updated</p>"},{"location":"networking/sop-virtual-networking-hub-spoke/#objective","title":"Objective","text":"<p>Deploy a production-grade, CAF/WAF-aligned Hub-Spoke topology that is repeatable, secure-by-default, and policy-enforced in every customer landing zone.</p>"},{"location":"networking/sop-virtual-networking-hub-spoke/#scope","title":"Scope","text":"<p>Mandatory for ALL new Azure environments and any brownfield refactoring.</p>"},{"location":"networking/sop-virtual-networking-hub-spoke/#prerequisites","title":"Prerequisites","text":"<ul> <li>Subscription placed under correct Management Group (Connectivity or Landing Zones)  </li> <li>Azure Policy \u201cDeploy Landing Zone \u2013 Networking\u201d initiative assigned  </li> <li>Engineer has Contributor + User Access Administrator on the subscription  </li> <li>IaC templates from official repo (Bicep or Terraform)</li> </ul>"},{"location":"networking/sop-virtual-networking-hub-spoke/#step-by-step-deployment","title":"Step-by-Step Deployment","text":"Step Action Tool Key Details / Success Criteria 1 Deploy Hub VNet Bicep/Terraform module Address space: e.g., 10.100.0.0/22Subnets: AzureBastion, AzureFirewall, GatewaySubnet (optional), JumpBox 2 Deploy Azure Firewall Premium + Firewall bu\u1ed5i Policy Same module Firewall Healthy, default DNAT/SNAT/App rules in place 3 Enable DDoS Standard Protection Plan Portal or IaC Plan linked to Hub VNet 4 Deploy Spoke VNet(s) Spoke module Minimum subnets: Application (/24), Database (/24), PrivateEndpoints (/26) 5 VNet Peering (bidirectional) Automatic in module Status = Connected both directionsAllow forwarded traffic = YesUse remote gateways = Yes (hub side) 6 Route Tables &amp; UDRs Automatic 0.0.0.0/0 \u2192 AzureFirewall private IP on all spoke subnetsRFC1918 propagated if ER/VPN present 7 Private DNS Resolver (or DNS forwarders) in Hub Module All spokes use Hub resolver 8 Deploy mandatory privatelink.* DNS zones &amp; VNet links Module Zones linked to Hub + all Spokes 9 Run Azure Policy compliance check Portal 100% compliant with Networking initiative 10 Validate effective routes &amp; NSG flow Network Watcher Traffic to internet \u2192 Firewall, PaaS \u2192 Private Endpoint"},{"location":"networking/sop-virtual-networking-hub-spoke/#mandatory-naming-convention","title":"Mandatory Naming Convention","text":"<p>vnet--hub--001 vnet--spoke---001 fw--hub--001 rt--spoke--default-001"},{"location":"networking/sop-virtual-networking-hub-spoke/#post-deployment-checklist-copy-into-ticket","title":"Post-Deployment Checklist (copy into ticket)","text":"<ul> <li>[ ] Hub &amp; Spoke VNets created  </li> <li>[ ] Azure Firewall Healthy  </li> <li>[ ] Peerings Connected both directions  </li> <li>[ ] 0.0.0.0/0 \u2192 Firewall on all spokes  </li> <li>[ ] Private DNS zones linked to all VNets  </li> <li>[ ] Azure Policy = 100% compliant  </li> <li>[ ] Topology diagram updated in repo  </li> <li>[ ] Customer sign-off obtained</li> </ul>"},{"location":"networking/sop-virtual-networking-hub-spoke/#approved-variations-need-architect-approval","title":"Approved Variations (need architect approval)","text":"Scenario Allowed? Alternative Third-party NVA (Palo Alto, etc.) Yes Replace AzFW module Multi-region connectivity Yes Global peering + regional firewalls Existing ExpressRoute/VPN Yes Add GatewaySubnet + BGP propagation"},{"location":"networking/sop-virtual-networking-hub-spoke/#rollback-steps","title":"Rollback Steps","text":"<ol> <li>Delete workload resources in spokes  </li> <li>Remove spoke \u2192 hub peering  </li> <li>Delete spoke VNet  </li> <li>(Full rollback) Delete subscription-level deployment</li> </ol>"}]}